{% load rsm_extras %}

<h2>{{ system.full_name }}</h2>
<p>{{system.description|safe|linebreaks}}


<hr>
<h2>The next experiment</h2>

<span class="rsm-error input-error">
{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}
<span>

<form action="{% url 'rsmapp:show_one_system' system.slug %}" method="post">
{% csrf_token %}
{% for item in input_set.all %}
    <p>
    <label for="{{item.slug}}">{{item.display_name}}</label>: &nbsp;
    {{item.units_prefix}}

    {% if item.ntype == "CON" %}
    <input type="text"
           name="{{item.slug}}"
           size="7"
           maxlength="7"
           placeholder="{{item.default_value|get_floatformat:item.n_decimals}}"
           {% if values %}
               value="{{ values|get_item:item.slug|floatformat:3 }}"
           {% endif %}
           id="{{item.slug}}"/>
    {% elif item.ntype == "CAT" %}
        {% for key, value in categoricals|dict_iteration:item.slug %}
            <input type="radio" name="{{item.slug}}" value="{{key}}">{{key}}
        {% endfor %}
    {% endif %}
           {{item.units_suffix}}

    <span id={{item.slug}}-error>{% if item.error_message%}
                                        ({{item.error_message}})
                                  {% endif %}
    </span>

{% endfor %}
<p><input type="submit" value="Run my experiment!" />
</form>

<hr>
<h2>Previous experiments run</h2>

<table width="100%">
<tr><td width="600px">{{plot_html|safe}}</td>
<td>
{# Table of experimental results here #}
<table class="prev-expts-table">
    <tr>
    <th>Experiment number</th>
    <th>Date and time</th>
    <th>Temperature [K]</th>
    <th>Batch duration [min]</th>
    <th>Solvent type</th>
    <th>Profit [$/kg]</th>
    </tr>

    {% for expt in PrevExpts %}
    {%spaceless%}
    <tr class="{% cycle 'odd' 'even' %} expt-result">
        <td class="expt-number">{{expt.number}}</td>
        <td class="datetime">{{expt.date_time|date:"d F Y H:i:s"}}</td>
        <td class="factor_A">{{expt.factor_A|floatformat:0}}</td>
        <td class="factor_B">{{expt.factor_B|floatformat:0}}</td>
            <td class="factor_C">{{expt.factor_C}}</td>
        <td class="response">{{expt.response|floatformat:0}}</td>
    </tr>
    {% endspaceless %}
    {% endfor %}
</table>


</td></tr>
</table>