<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
	<head>

		<script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>

</head>
<body>
<style type="text/css">
/*	#rsmchart {
		position: relative;
		left: 0px;
		right: 0px;
		top: 0px;
		bottom: 0px;
		width: 100%;
		display: inline-block;
		vertical-align: middle;
		overflow: hidden;
	}*/
	.axis path,
	.axis line {
		fill: none;
		stroke: #000;
		shape-rendering: crispEdges;
	}
	.tick{
		font: 12px sans-serif;
	}
	.grid .tick {
	    stroke: lightgrey;
	}

</style>
Text above
<div id="rsmchart"></div>
Text below
<script type="text/javascript">

// Global defaults
var n_ticks_x = 8;
var n_ticks_y = 8;
var deltabuffer = 5; // small buffers away from axes
var margin = {top:40, right:40, bottom:40, left:50 }

var chartDiv = document.getElementById("rsmchart");
var svgcontainer = d3.select(chartDiv)

function redraw_rsmchart(){
	
	svgcontainer.selectAll("*").remove();
	
	// Extract the width and height that was computed by CSS.
	var outerwidth = chartDiv.clientWidth;;
	var outerheight = 400;
	var width = outerwidth - margin.left - margin.right;
	var height = outerheight - margin.top - margin.bottom;

	// ``range``: the output scale mapped to SVG port dimensions
	var scalex = d3.scale.linear().range([0, width]);
	var scaley = d3.scale.linear().range([height, 0]);
	
	
var svg = svgcontainer.append("svg")
	.attr("width", outerwidth)
	.attr("height", outerheight)
	.attr('class','rsm-figure')

	// Everything that will be added to the plot is now
	// relative to this transformed container.
	.append("g")
	.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
	
// To help with layout: show the boundaries
// Do not ordinarily display this.
// svg.append("rect")
//     .attr("width", width)
//     .attr("height", height)
//     .attr("opacity", 0.2);
	
// Set the axes, as well as details on their ticks
var xAxis = d3.svg.axis()
    .scale(scalex)
    .ticks(n_ticks_x)
    .tickSubdivide(true)
    .tickSize(6, 0);

var yAxis = d3.svg.axis()
    .scale(scaley)
    .ticks(n_ticks_y)
    .tickSubdivide(true)
    .tickSize(6, 0);
		
scalex.domain([0.7325, 1.0175]);
scaley.domain([298, 326]);
		
var rawdata = [{"x": 0.76, "y": 325.0, "rad": 5, "col": "black", "ord": 1},
               {"x": 1.00, "y": 300.0, "rad": 5, "col": "black", "ord": 2},
		       {"x": 0.85, "y": 312.0, "rad": 5, "col": "red", "ord": 3},];

// Bottom x-axis
svg.append("g")
	.attr("class", "x axis bottom")
	.attr("transform", "translate(0 ," + height + ")")
	.call(xAxis.orient("bottom"))
		
// Bottom X-axis label	
svg.append("g")
	.attr("class", "x axis bottom label")
	.attr("transform", "translate(0," + (height + margin.bottom) + ")")
	.append("text")
	.attr("font-family", "sans-serif")
	.attr("x", (width)/2)
	.attr("y", 0)
	.style("text-anchor", "middle")
	.text("X-axis-label");
	
// Top x-axis
svg.append("g")
	.attr("class", "x axis top")
	.attr("transform", "translate(0, 0)")
	.call(xAxis.orient('top'));
	
// X-axis gridlines
svg.append("g")         
	.attr("class", "x grid")
	.attr("transform", "translate(0, 0)")
	.call(xAxis
		.tickSize(-height, 0, 0)
		.tickFormat("")
	)

// Y-axis and y-axis label
svg.append("g")
	.attr("class", "y axis left")
	.attr("transform", "translate(0, 0)")
	.call(yAxis.orient("left"))
	
// Y-axis label
svg.append("g")
	.attr("class", "y axis left label")
	.attr("transform", "translate(" + -margin.left/3*2 + "," + 0 + ")") 
	.append("text")
	.attr("transform", "rotate(270)")
	.attr("class", "axislabel")
	.attr("font-family", "sans-serif")
	.attr("x", -height/2.0)
	.attr("y", -deltabuffer)
	.style("text-anchor", "middle")
	.text("Y-axis-label");
	
// Y-axis right hand side
svg.append("g")
	.attr("class", "y axis right")
	.attr("transform", "translate(" + width + "," + 0 + ")")
	.call(yAxis.orient("right"));

// Y-axis gridlines
svg.append("g")         
	.attr("class", "y grid")
	.attr("transform", "translate(0, 0)")
	.call(yAxis
		.tickSize(width, 0, 0) 
		.tickFormat("")
	)
	
// Chart title
svg.append("g")
	.append("text")
    .attr("class", "rsm-plot title")
	.attr("transform", "translate(" + (0) + "," + (-0.5*margin.top) + ")") // halfway between the plot and the outer edge
    .attr("x", (width/2.0))
    .attr("y", -deltabuffer)
	.attr("font-family", "sans-serif")
	.attr("font-size", "20px")
	.attr("fill", "black")
	.attr("text-anchor", "middle")
    .text("Response surface: summary of all experiments performed");
	
// Data is placed last (on top of gridlines)
var circles = svg.append("g")
	.selectAll("circle")
	.data(rawdata)
	.enter()
	.append("circle")
	.attr("class", "rsm-plot datapoints")
	.attr("cx", function (d) { return scalex(d.x); })
	.attr("cy", function (d) { return scaley(d.y); })
	.attr("r",  function (d) { return d.rad; })
	.attr("radius",  function (d) { return d.rad; })
	.style("fill", function(d) { return d.col; })
	.attr("ord", function (d) { return d.ord; });

// What to do when we mouse over a bubble
var mouseOn = function() { 
	var circle = d3.select(this);
	
	circle.transition()
		.duration(800)
		.style("opacity", 1)
		.attr("r", parseInt(circle.attr('radius'))*2)
		.ease("elastic");

	// append lines to bubbles that will be used to show the precise data points.
	// translate their location based on margins
	svg.append("g")
		.attr("class", "guide")
		.append("line")
		.attr("x1", circle.attr("cx"))
		.attr("x2", circle.attr("cx"))
		.attr("y1", +circle.attr("cy"))
		.attr("y2", height)
		.style("stroke", circle.style("fill"));

	svg.append("g")
		.attr("class", "guide")
		.append("line")
		.attr("x1", +circle.attr("cx"))
		.attr("x2", 0)
		.attr("y1", circle.attr("cy"))
		.attr("y2", circle.attr("cy"))
		.style("stroke", circle.style("fill"));

// function to move mouseover item to front of SVG stage, in case
// another bubble overlaps it
	d3.selection.prototype.moveToFront = function() { 
	  return this.each(function() { 
		this.parentNode.appendChild(this); 
	  }); 
	};
};

// what happens when we leave a bubble?
var mouseOff = function() {
	var circle = d3.select(this);

	// go back to original size and opacity
	circle.transition()
		.duration(800)
		.style("opacity", 1.0)
		.attr("r", parseInt(circle.attr("radius")))
		.ease("sin");

	// fade out guide lines, then remove them
	d3.selectAll(".guide")
		.transition()
		.duration(100)
		.styleTween("opacity", function() { 
			return d3.interpolate(.5, 0); })
		.remove()
};

// run the mouseon/out functions
circles.on("mouseover", mouseOn);
circles.on("mouseout", mouseOff);

}
redraw_rsmchart();
// Redraw char whenever the browser window is resized.
window.addEventListener("resize", redraw_rsmchart);
</script>

</body>
</html>
